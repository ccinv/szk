标程：https://github.com/ccinv/szk/tree/master/setting/20180817

`mid` by sfc;

`slab`、`lalala` by syh

# slab

这题按难度排序应该放在第一题，本题送分。

对于 $40\%$ 的数据，不难想到一个 $O(n^2)$ 的 DP，先将区间按左端点排序设 $f[i][j]$ 为做完前 $i$ 个区间的选择，已经选了 $j$ 个区间，且第 $i$ 个必选的最大收益。则转移为 $f[i][j] = max\{ f[z][j-1] + len[i] - overlap(z,i) \}$，其中 $ z \leq i$，$overlap(i,j)$ 表示两个区间的交集长度，如果没有交集则为 $0$。

对于 $70 \%$ 的数据，考虑优化这个 DP，记 $c[i][j] = f[i][j]-r[i]$，则转移可以分类，对于和 $i$ 有交集的 $z$， $f[i][j] = max\{r[i]+c[z][j-1]\}$，否则 $f[i][j] = max\{len[i] + f[z][j-1]\}$，两个取最大值与维护的操作都可以简单地使用 set 或其他数据结构完成。

对于 $100\%$ 的数据，考虑单调性，对于一个 $f[i][j]$ 状态，$ c[i][j] $ 肯定是随着 $i$ 的递增而递减的，这样第一种转移只要考虑最左边的和当前区间有交集的区间即可，第二种就是简单地取最大值。实现可以用 `two point` 或者单调队列。

改编自 `USACO JAN18 PLATINUM LIFEGUARDS`

# mid

此题最大的难点应该是考虑到二分答案（虽然在考试开始你们都已经知道了）。

二分出一个数后，将大于这个数的赋为 1，其余赋为 0，于是我们得到了一个 01 序列。

经过仔细观察，我们可以发现，一段相等的数会不断向上延伸，就想某生意人永远不翻的车一样，而 01010 等间隔的串随着高度向上不断缩短。如下图所示：

> ​          1  
>
> ​       _ 1 1 
>
> ​    _ _ 1 1 _ 
>
>  _ _ _ 1 1 _ _

我们把这称之为柱子，则对于某个排列如果它最上方的数为 0，有以下情况：

1. 它的第 $n$ 位是柱子。
2. 以它的第 $n$ 位为中心，左边或者右边只有为 0 的柱子。
3. 以它的第 $n$ 位为中心，两边最近的柱子都为 0。
4. 以它的第 $n$ 位为中心，两边的柱子分别为 0 和 1，但是 0 柱子离中心较近。
5. 以它的第 $n$ 位为中心，左右两边都没有柱子，则需要序列第 1 位为 0。

以下为情况4的证明：

>1| 1 1 1 1 1 0 0 0 0 0 |0
>
>1| 1 1 1 1 1 0 0 0 0 0 |0
>
>1| 1 1 1 1 0 1 0 0 0 0 |0
>
>1| 1 1 1 0 1 0 1 0 0 0 |0
>
>1| 1 1 0 1 0 1 0 1 0 0 |0
>
>1| 1 0 1 0 1 0 1 0 1 0 |0
>
>1| 0 1 0 1 0 1 0 1 0 1 |0

该图左边是 1 柱子，右边是 0 柱子。依图可证明，其他证明同理。

那么这样你就帮助生意人定好了中庸的价格，帮助她抬高了身价。作为奖励，你将会获得一张优惠卡。

原题是 `AGC006D`

# usmjeri

这是原来的第三题，肝得怎么样啊？

首先把问题转化为给边染色：对于每个限制 $a_i,b_i$ ，给树上的边染色，令 $c_i=lca(a_i,b_i)$，使得 $a_i \rightarrow c_i$ 上的边颜色相同，$b_i \rightarrow c_i$ 上的边颜色相同，如果 $a_i,b_i$ 不属于一条链，还需满足 $a_i \rightarrow c_i$ 与 $b_i \rightarrow c_i$ 上的颜色互异。

先尝试解决一个 auxiliary problem：多次把树上路径之间的所有点合并，求联通块个数？做法类似于差分：维护 $low$ 数组，初始 $low_x=dep_x$ 合并 $a,b$ 时做一个操作 $$low_a=min(low_a,dep_c),low_b=min(low_b,dep_c)$$

这样从根再做一遍 dfs，把 $low$ 值小于当前节点深度的儿子与当前节点连边。对新图再 dfs 一遍就可以求出解。

然后对于每个限制，把两点到 lca 的链合并，如果不在一条链上，再把这两个点也连上特殊边。注意一个合法的联通块中，不能存在有奇数条特殊边的环，否则答案就是 $0$，所以要跑一边二分图染色判断是否合法，若合法，每个联通块的贡献只能是 $2$，乘到答案里就可以了。

原题是 `COCI2018 CONTEST2 USMJERI`